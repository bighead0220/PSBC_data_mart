#!/bin/bash

######################################################################################################
##                                                                                                  ##   
##    USAGE   : vmon $1 $2 $3                                                                       ##   
##    $1 ==>  engp|ps|load|locks|se|sql|pjr|resrc|pp|rps|resrcacq|qm|qry|pjs                        ##
##            |cnode|io|ds|tab|tabpart|col|tabsize|skew|skew1|cnt|dcnt|ddl|dja|dj|dta|dt|lic           ##   
##     ep       : engine profile                                                                    ##   
##     ps       : PROJECTION_STORAGE                                                                ##   
##     load     : LOAD INFO                                                                         ##   
##     lock     : LOCK INFO                                                                         ##   
##     locks    : LOCK INFO                                                                         ##   
##     se       : SESSION INFO                                                                      ##   
##     sql      : SQL                                                                               ##   
##     pjr      : PROJECTION REFERENCES                                                             ##   
##     resrc    : RESOURCE USAGE                                                                    ##   
##     rp       : RESOURCE POOL                                                                     ##   
##     rps      : RESOURCE POOL STATUS                                                              ##   
##     qm       : QUERY METRIX                                                                      ##   
##     qry      : QUERY INFO                                                                        ##   
##     pjs      : PROJECTION STORAGE                                                                ##   
##     cnode    : CRITICAL NODE INFO                                                                ##   
##     io       : IO USAGE INFO                                                                     ##   
##     ds       : DISK USAGE INFO                                                                   ##   
##    *tab      : TABLE  INFO                                                                       ##   
##     tabpart  : TABLE  PARTITION                                                                  ##   
##    *col      : TABLE COLUMN INFO                                                                 ##   
##     tabsize  : TABLE SIZE                                                                        ##   
##     skew     : SKEW  INFO                                                                        ##   
##     skew1    : SKEW  INFO                                                                        ##   
##     cnt      : COUNT QUERY INFO                                                                  ##   
##    *dcnt     : DISTINCT COUNT QUERY INFO                                                         ##   
##     ddl      : DDL INFO                                                                          ##   
##     dja      : ALL PROJECTIONS LIST                                                              ##   
##    *dj       : ONE PROJECTION LIST                                                               ##   
##     dta      : TABLE INFO                                                                        ##   
##    *dt       : ONE TABLE INFO                                                                    ##   
##     lic      : License INFO                                                                      ##   
##     * ==> MORE PARM                                                                              ##   
##    $2 ==> TABLE NAME                                                                             ##   
##    $3 ==> COLUNM NAME                                                                            ##   
##                                                                                                  ##    
##    Copyrights HYUN LEE                                                                           ##   
##    Last Updated 2012.07.13                                                                       ##   
##                                                                                                  ##   
######################################################################################################


################   MONITORING   ######################################################################   

UR=mart
PW=mart128
SKEW=/tmp
OUTDIR=/home/$UR/Scripts/

if [ $# -lt 1 ]
   then 
   echo " "
   echo " =============================================================================================="
   echo " Copy rights reserved by Hyun Lee                                                              "
   echo " HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN"
   echo " =============================================================================================="
   echo " "
   echo "   USAGE : vmon \$1 \$2 \$3 "
   echo "           $1 ==>  engp|ps|load|locks|se|sql|pjr|resrc|rp|rps|resrcacq|qm|qry|pjs           "
   echo "                  |cnode|io|tab|tabpart|col|tabsize|skew|skew1|cnt|dcnt|ddl|dja|dj|dta|dt|lic"
   echo "          pjs|tab|col|tabpart|skew|skew1        ==> \$2 => table_name"
   echo "          dcnt|ddl                              ==> \$3 => column_name" 
   echo "          dj|dt                                 ==> \$2 => table_name" 
   echo " "
   echo " =============================================================================================="
   echo " HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN~HYUN"
   echo " =============================================================================================="
   echo " "
fi 

 # echo " === :  $2" ;

case "$1" in

  mg) 
    vsql -h 22.224.65.2 -U $UR -w $PW -c " SELECT    TO_CHAR(OPERATION_START_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS OP_TM
                                     ,SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)   AS NODE
                                     ,SESSION_ID                                      AS SESSION
                                     --,TABLE_SCHEMA                                    AS SCHEMA
                                     ,TABLE_NAME                                      AS TABLE
                                     ,PROJECTION_NAME                                 AS PROJECTION
                                     ,OPERATION_NAME                                  AS OP_NM
                                     ,CASE OPERATION_STATUS    WHEN 'Start'      THEN 'S'
                                                        WHEN 'Running'    THEN 'R'
                                                        WHEN 'Complete'   THEN 'C'
                                                        ELSE OPERATION_STATUS
                                      END   AS  OP_ST
--                                     ,OPERATION_STATUS                                AS OP_ST
                                     --,TABLE_SCHEMA                                    AS SCHEMA
                                     --,TABLE_NAME                                      AS TABLE
                                     --,PROJECTION_NAME                                 AS PROJECTION
                                     --,PROJECTION_ID                   
                                     --,COLUMN_ID                           
                                     ,EARLIEST_CONTAINER_START_EPOCH                  AS S_EPOCH
                                     ,LATEST_CONTAINER_END_EPOCH                      AS L_EPOCH  
                                     ,ROS_COUNT                                       AS ROS_CNT
                                     ,TOTAL_ROS_USED_BYTES                            AS 'T_ROS_U(B)'
                                     ,PLAN_TYPE                                       AS PLAN_TYPE
                                     --,SESSION_ID                                      AS SESSION
                                     ,CASE IS_EXECUTING WHEN 't' THEN 'RUNNING'
                                                            WHEN 'f' THEN 'IN THE PAST'  
                                      END   AS EXEC
                                     --,RUNTIME_PRIORITY                                  AS PRIORITY    
                              FROM    TUPLE_MOVER_OPERATIONS
                    --         WHERE    IS_EXECUTING = 't'  
                             ORDER BY OPERATION_START_TIMESTAMP DESC 
                             LIMIT 10  "

  ;;
  engp)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    EXE.SESSION_ID                                          AS SESSION
                                     ,EXE.TRANSACTION_ID                                      AS TRANS_ID
                                     ,SUBSTR(EXE.NODE_NAME,3,1)||SUBSTR(EXE.NODE_NAME,14,2)                                           AS NODE
                            --         ,USER_ID                                             AS USER_ID
                                     ,EXE.USER_NAME                                           AS USER
                            --         ,EXE.TRANSACTION_ID                                      AS TRANS_ID
                            --         ,STATEMENT_ID                                        AS STMT_ID
                                     ,OPERATOR_ID                                         AS OP_ID
                                     ,EXE.OPERATOR_NAME                                       AS OP_NM
                            --         ,OPERATOR_ID                                         AS OP_ID
                            --         ,BASEPLAN_ID                                         AS BPLN_ID
                            --         ,PATH_ID                                             AS PATH_ID
                            --         ,LOCALPLAN_ID                                        AS L_PLN_ID
                                     ,EXE.COUNTER_NAME                                        AS COUNTER_NM
                                     --,EXE.COUNTER_TAG                                         AS COUNTER_TAG
                                     ,EXE.COUNTER_VALUE                                       AS COUNTER_VALUE
                                     --,CASE EXE.IS_EXECUTING WHEN 't' THEN 'RUNNING'
                            --                   WHEN 'f' THEN 'IN THE PAST'  END  AS EXEC
                                     ,SUBSTR(SE.CURRENT_STATEMENT,1,20)      AS CUR_STMT
                              FROM    V_MONITOR.EXECUTION_ENGINE_PROFILES EXE
                                     ,SESSIONS                            SE
                             WHERE    SE.SESSION_ID = EXE.SESSION_ID
                               AND    EXE.IS_EXECUTING = 't'
                             ORDER BY EXE.COUNTER_VALUE DESC
                                     ,SESSION ASC
                                     ,NODE ASC
                                     ,OP_ID 
                            --         ,EXEC DESC
                          "
    ;;

  ps)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    --ANCHOR_TABLE_SCHEMA                       AS SCHEMA
                       ANCHOR_TABLE_NAME                         AS TABLE
                       ,SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)   AS NODE  
   --                    ,NODE_NAME                                 AS NODE
    --                  ,PROJECTION_SCHEMA                        AS PJECTION
                       ,SUBSTR(PROJECTION_NAME,1,30)              AS PJ_NAME
    --                   ,PROJECTION_COLUMN_COUNT                 AS
                       ,ROW_COUNT                                 AS ROW_CNT
                       ,CAST((USED_BYTES/1024/1024) AS DEC(10,2)) AS 'USED(MB)'
    --                   ,USED_BYTES                                AS 'USED(B)'
                       ,WOS_ROW_COUNT                             AS WOS_CNT
                       ,WOS_USED_BYTES                            AS WOS_UB
                       ,ROS_ROW_COUNT                             AS ROS_CNT
                       ,ROS_USED_BYTES                            AS ROS_UB
                       ,ROS_COUNT                                 AS ROS_CNT
    --                   ,ANCHOR_TABLE_SCHEMA                       AS SCHEMA
                FROM    V_MONITOR.PROJECTION_STORAGE
               ORDER BY ANCHOR_TABLE_NAME
                       ,NODE
             "
    ;;

  load)
   vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    CASE IS_EXECUTING WHEN 't' THEN 'RUNNING'
                                          WHEN  'f' THEN 'IN THE PAST' END  AS STATUS
     --                  ,SESSION_ID                                          AS SESSION
             --          ,TRANSACTION_ID                                      AS TRANS_ID
             --          ,STATEMENT_ID                                        AS STMT_ID
      --                 ,SUBSTR(STREAM_NAME,1,5)                             AS STREAM_ID
                         ,SCHEMA_NAME                                         AS SCHEMA
                         ,TABLE_NAME                                          AS TABLE
                         ,SUBSTR(LOAD_START,1,22)                             AS STRT_DT
           --            ,(LOAD_DURATION_MS/1000)                             AS 'EXE_TM(S)'
                         ,ACCEPTED_ROW_COUNT                                  AS ACP_CNT
                         ,REJECTED_ROW_COUNT                                  AS REJ_CNT
             --          ,READ_BYTES                                          AS FILE_SIAE(KB)
                         ,(INPUT_FILE_SIZE_BYTES//1024//1024)                 AS INPUT_SZ_MB
                         ,PARSE_COMPLETE_PERCENT                              AS 'COM(%)'
             --          ,UNSORTED_ROW_COUNT                                  AS
             --          ,SORTED_ROW_COUNT                                    AS SORT_CNT
                         ,SORT_COMPLETE_PERCENT                               AS 'SORT(%)'
                  FROM    LOAD_STREAMS
                 WHERE    IS_EXECUTING = 't'
			  and read_bytes > 0
                 ORDER BY LOAD_START
       "

    ;;


  lock)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT     DISTINCT LU.SESSION_ID                                AS SESSION
                        ,L.TRANSACTION_ID                                      AS TRANS_ID
                        ,SUBSTR(LU.NODE_NAME,3,1)||SUBSTR(LU.NODE_NAME,14,2)   AS NODE
                        ,CASE WHEN L.NODE_NAMES = 'v_rtdw_node0001,v_rtdw_node0002,v_rtdw_node0003' THEN 'r01,r02,r03' 
                             WHEN L.NODE_NAMES = 'v_rtdw_node0001,v_rtdw_node0002' THEN 'r01,r02' 
                             WHEN L.NODE_NAMES = 'v_rtdw_node0001,v_rtdw_node0003' THEN 'r01,r03' 
                             WHEN L.NODE_NAMES = 'v_rtdw_node0002,v_rtdw_node0003' THEN 'r02,r03' 
                             WHEN L.NODE_NAMES = 'v_rtdw_node0001' THEN 'r01'  
                             WHEN L.NODE_NAMES = 'v_rtdw_node0002' THEN 'r02'  
                             WHEN L.NODE_NAMES = 'v_rtdw_node0003' THEN 'r03'  
                        END                                                     NODE_NAMES  
                       ,LU.OBJECT_NAME                                        AS OBJECT
    --                   ,LU.MODE
                       ,CASE WHEN LU.MODE = 'S' THEN 'Share'
                             WHEN LU.MODE = 'I' THEN 'Insert'
                             WHEN LU.MODE = 'X' THEN 'Exclusive'
                             WHEN LU.MODE = 'T' THEN 'Tuple Mover'
                             WHEN LU.MODE = 'U' THEN 'Usage'
                             WHEN LU.MODE = 'O' THEN 'OWNER'
                        END                                                   AS MODE
    --                   ,AVG_HOLD_TIME                                         AS AVG_H
    --                   ,MAX_HOLD_TIME                                         AS MAX_H
                       ,HOLD_COUNT                                            AS H_CNT
    --                   ,AVG_WAIT_TIME                                         AS AVG_W
    --                   ,MAX_WAIT_TIME                                         AS MAX_W
                       ,WAIT_COUNT                                            AS W_CNT
    --                   ,CASE WHEN L.NODE_NAMES = 'v_rtdw_node0001,v_rtdw_node0002,v_rtdw_node0003' THEN 'r01,r02,r03' 
    --                         WHEN L.NODE_NAMES = 'v_rtdw_node0001,v_rtdw_node0002' THEN 'r01,r02' 
    --                         WHEN L.NODE_NAMES = 'v_rtdw_node0001,v_rtdw_node0003' THEN 'r01,r03' 
    --                         WHEN L.NODE_NAMES = 'v_rtdw_node0002,v_rtdw_node0003' THEN 'r02,r03' 
    --                         WHEN L.NODE_NAMES = 'v_rtdw_node0001' THEN 'r01'  
    --                         WHEN L.NODE_NAMES = 'v_rtdw_node0002' THEN 'r02'  
    --                         WHEN L.NODE_NAMES = 'v_rtdw_node0003' THEN 'r03'  
    --                    END                                                     NODE_NAMES  
    --                   ,L.OBJECT_NAME
    --                   ,L.OBJECT_ID
    --                   ,L.TRANSACTION_ID                                   AS TRANS_ID
    --                   ,L.LOCK_MODE                                           AS LOCK
                       ,L.LOCK_SCOPE
    --                   ,L.REQUEST_TIMESTAMP                                 AS REQ_TIME
    --                   ,L.GRANT_TIMESTAMP                                   AS GRN_TIME
                         ,SUBSTR(L.TRANSACTION_DESCRIPTION,1,20) AS STMT
                FROM    V_MONITOR.LOCK_USAGE LU ,  V_MONITOR.LOCKS L
               WHERE   LU.OBJECT_NAME = L.OBJECT_NAME
                 AND   WAIT_COUNT <> 0
                   AND    HOLD_COUNT <> 0
                 AND   LU.OBJECT_NAME ILIKE 'Table%'
               ORDER BY LU.SESSION_ID
                       ,LU.OBJECT_NAME
    --                   ,NODE_NAME
            "
    ;;

  locks)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    -- NODE_NAMES                                           AS NODE
                       MAX(SUBSTR(OBJECT_NAME,7))                             AS OBJECT
    --                   ,OBJECT_ID 
                       ,TRANSACTION_ID                                        AS TRANS_ID
    --                   ,CASE WHEN LOCK_SCOPE = 'REQUESTED' THEN 'WAITING'
    --                         ELSE 'RUNNING'
    --                    END                                                   AS LOCK
                       ,CASE WHEN LOCK_MODE = 'S' THEN 'Share'
                             WHEN LOCK_MODE = 'I' THEN 'Insert'
                             WHEN LOCK_MODE = 'X' THEN 'Exclusive'
                             WHEN LOCK_MODE = 'T' THEN 'Tuple Mover'
                             WHEN LOCK_MODE = 'U' THEN 'Usage'
                             WHEN LOCK_MODE = 'O' THEN 'OWNER'
                        END                                                   AS MODE
                       ,TO_CHAR(REQUEST_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS.MS')      AS REQ_TIME
                       ,TO_CHAR(GRANT_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS.MS')        AS GRN_TIME
                       ,SUBSTR(TRANSACTION_DESCRIPTION,22,50)                 AS STMT
                FROM    V_MONITOR.LOCKS
     --          WHERE    OBJECT_NAME ILIKE 'Table%'
               GROUP BY OBJECT_NAME
                       ,NODE_NAMES
     --                  ,OBJECT_ID
                       ,TRANSACTION_ID                  
                       ,LOCK_SCOPE
                       ,LOCK_MODE
                       ,REQUEST_TIMESTAMP
                       ,GRANT_TIMESTAMP
                       ,TRANSACTION_DESCRIPTION
               ORDER BY OBJECT_NAME

            "
    ;;


  se)
    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    --NODE_NAME
                         SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)   AS NODE 
                         ,USER_NAME                                     AS USER
                         ,CLIENT_HOSTNAME                              AS CLIENT_H
    --                   ,CLIENT_PID
    --                   ,LOGIN_TIMESTAMP
                       ,SESSION_ID                                                 AS SESSION
                       ,TRANSACTION_ID                                             AS TRANS_ID
   --                    ,STATEMENT_ID                                               AS STMT_ID
                       ,SUBSTR(CLIENT_LABEL,1,5)                                    AS APP 
    --                   ,TO_CHAR(TRANSACTION_START,'YYYY-MM-DD-HH:MI:SS')        AS TRANS_STRT
    --                   ,TRANSACTION_ID                    AS TRAN_ID
    --                   ,TRANSACTION_DESCRIPTION
                       ,TO_CHAR(STATEMENT_START,'YYYY-MM-DD-HH:MI:SS')          AS STMT_STRT 
    --                   ,STATEMENT_ID                                               AS STMT_ID
    --                   ,LAST_STATEMENT_DURATION_US
    --                   ,RUNTIME_PRIORITY
                       ,SUBSTR(CURRENT_STATEMENT,1,30)                             AS CUR_STMT
    --                   ,SUBSTR(LAST_STATEMENT,1,40)                                AS LST_STMT
    --                  ,SSL_STATE
    --                   ,AUTHENTICATION_METHOD
                 FROM   SESSIONS
    --            WHERE   TRANSACTION_ID <> '-1'
                 WHERE  CURRENT_STATEMENT IS NOT NULL AND CURRENT_STATEMENT <> '' 
                   AND  CURRENT_STATEMENT NOT ILIKE '%NODE_NAME SUBST%'
                --ORDER BY TRANS_STRT
            "
    ;;


  sem)
    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    --NODE_NAME
                         SUBSTR(SE.NODE_NAME,3,1)||SUBSTR(SE.NODE_NAME,14,2)   AS NODE
                         ,SE.USER_NAME                                     AS USER
    --                     ,SE.CLIENT_HOSTNAME                              AS CLIENT_H
    --                   ,CLIENT_PID
    --                   ,SE.LOGIN_TIMESTAMP
                       ,SE.SESSION_ID                                                 AS SESSION
                       ,SE.TRANSACTION_ID                                             AS TRANS_ID
    --                   ,SE.STATEMENT_ID                                               AS STMT_ID
    --                   ,SUBSTR(SE.CLIENT_LABEL,1,5)                                    AS APP
    --                   ,TO_CHAR(SE.TRANSACTION_START,'YYYY-MM-DD-HH:MI:SS')        AS TRANS_STRT
    --                   ,SE.TRANSACTION_ID                    AS TRAN_ID
    --                   ,SE.TRANSACTION_DESCRIPTION
                       ,TO_CHAR(SE.STATEMENT_START,'YYYY-MM-DD-HH:MI:SS')          AS STMT_STRT
    --                   ,SE.STATEMENT_ID                                               AS STMT_ID
    --                   ,SE.LAST_STATEMENT_DURATION_US
    --                   ,SE.RUNTIME_PRIORITY
                         ,CAST(RA.MEMORY_INUSE_KB/1024 AS DEC(10,2))          AS 'USED_MEM(MB)'
                       ,SUBSTR(SE.CURRENT_STATEMENT,1,130)                             AS CUR_STMT
    --                   ,SUBSTR(LAST_STATEMENT,1,40)                                AS LST_STMT
    --                  ,SE.SSL_STATE
    --                   ,SE.AUTHENTICATION_METHOD
                         --,CAST(RA.MEMORY_INUSE_KB/1024 AS DEC(10,2))          AS 'USED_MEM(MB)'
                 FROM   SESSIONS SE
                 --LEFT OUTER JOIN
                        ,RESOURCE_ACQUISITIONS RA
                --   ON  ( SE.TRANSACTION_ID = RA.TRANSACTION_ID AND SE.STATEMENT_ID = RA.STATEMENT_ID) 
                WHERE   SE.TRANSACTION_ID <> '-1'
                   AND  SE.TRANSACTION_ID = RA.TRANSACTION_ID AND SE.STATEMENT_ID = RA.STATEMENT_ID 
                --WHERE   
                -- SE.TRANSACTION_ID = RA.TRANSACTION_ID 
                --  AND    SE.STATEMENT_ID = RA.STATEMENT_ID 
                  AND    SE.CURRENT_STATEMENT IS NOT NULL AND SE.CURRENT_STATEMENT <> ''
                  GROUP BY SE.NODE_NAME
                          ,SE.USER_NAME,SE.SESSION_ID,SE.TRANSACTION_ID,SE.STATEMENT_START,SE.CURRENT_STATEMENT,RA.MEMORY_INUSE_KB
                --ORDER BY TRANS_STRT
            "
    ;;

  sql)
    vsql -h 22.224.65.50 -U $UR -w $PW -c "\x"
    vsql -h 22.224.65.50 -U $UR -w $PW -c "  SELECT    --NODE_NAME
    --                    USER_NAME
                       CLIENT_HOSTNAME
    --                   ,CLIENT_PID
    --                   ,LOGIN_TIMESTAMP
    --                   ,SESSION_ID                         AS SESSION
    --                   ,CLIENT_LABEL
    --                   ,TRANSACTION_START
    --                   ,TRANSACTION_ID
    --                   ,TRANSACTION_DESCRIPTION
    --                   ,STATEMENT_START
    --                   ,STATEMENT_ID
    --                   ,LAST_STATEMENT_DURATION_US
    --                   ,RUNTIME_PRIORITY
                        ,CURRENT_STATEMENT             AS CUR_STMT
    --                   ,SUBSTR(LAST_STATEMENT,1,40)        AS LST_STMT
    --                  ,SSL_STATE
    --                   ,AUTHENTICATION_METHOD
                 FROM   SESSIONS
            "
    ;;

  pjr)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   --NODE_NAME                                           AS NODE
                            --         ,SUBSTR(ANCHOR_TABLE_NAME,1,15)                       AS TABLE
                                      ANCHOR_TABLE_NAME                                    AS TABLE
                                     ,PROJECTION_NAME                                      AS PJ_NAME
                                     ,SUBSTR(REFRESH_STATUS,1,30)                          AS STATUS
                                     ,REFRESH_PHASE                                        AS PHASE
                                     ,REFRESH_METHOD                                       AS METHOD
                                     ,REFRESH_FAILURE_COUNT                                AS F_CNT
                                     ,TO_CHAR(REFRESH_START,'YYYY-MM-DD-HH:MI:SS.MS')      AS START_TIME
                                     ,REFRESH_DURATION_SEC                                 AS DURATION_SEC
                                     ,CASE IS_EXECUTING WHEN 't' THEN 'RUNNING'
                                                        WHEN  'f' THEN 'IN THE PAST'  END  AS EXEC
                              FROM    V_MONITOR.PROJECTION_REFRESHES
                             ORDER BY ANCHOR_TABLE_NAME
                                     ,PROJECTION_NAME
                                     
                                       
                          "
     ;;

  resrc)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)                                       AS NODE
                                      ,REQUEST_COUNT                                   AS REQ_CNT
                                      ,LOCAL_REQUEST_COUNT                             AS LOCAL_REQ_CNT
                    --                  ,REQUEST_QUEUE_DEPTH
                    --                  ,ACTIVE_THREAD_COUNT
                    --                  ,OPEN_FILE_HANDLE_COUNT
                                      ,CAST(MEMORY_REQUESTED_KB/1024 AS DEC(15,2))     AS 'MEM_REQ(MB)'
                    --                  ,ADDRESS_SPACE_REQUESTED_KB
                                      ,CAST(WOS_USED_BYTES/1024/1024 AS DEC(15,2))     AS 'WOS_USED(MB)'
                                      ,WOS_ROW_COUNT                                   AS WOS_CNT
                                      ,CAST(ROS_USED_BYTES/1024/1024 AS DEC(15,2))     AS 'ROS_USED(MB)'
                                      ,ROS_ROW_COUNT                                   AS ROS_CNT
                                      ,TOTAL_ROW_COUNT                                 AS TOT_CNT
                                      ,CAST(TOTAL_USED_BYTES/1024/1024 AS DEC(15,2))   AS 'TOT_USED(MB)'
                    --                  ,RESOURCE_REQUEST_REJECT_COUNT
                    --                  ,RESOURCE_REQUEST_TIMEOUT_COUNT
                    --                  ,RESOURCE_REQUEST_CANCEL_COUNT
                                      ,DISK_SPACE_REQUEST_REJECT_COUNT                 AS DS
                                      ,FAILED_VOLUME_REJECT_COUNT                      AS FV
                                      ,TOKENS_USED                                     AS T_U
                                      ,TOKENS_AVAILABLE                                AS T_A
                               FROM    v_monitor.resource_usage
                              ORDER BY NODE_NAME
             "
    ;;

  rp)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT     NAME                                             AS POOL_NM
                                      --,CASE WHEN IS_INTERNAL = 't' THEN 'INTERNAL'
                                      --      ELSE 'MADE'
                                      -- END                                              AS IS_INTERNAL
                                      ,MEMORYSIZE                                       AS MEM_SZ
                                      ,MAXMEMORYSIZE 
                                      --,PRIORITY 
                                      ,QUEUETIMEOUT                                     AS QUEUETIMEOUT
                                      ,MAXCONCURRENCY                                   AS MAXCON
                                      ,PLANNEDCONCURRENCY                               AS PLANNEDCON
                                      --,CASE WHEN SINGLEINITIATOR = 't' THEN 'SINGLE' 
                                      --                                 ELSE 'MULTI'
                                      -- END                                              AS SINGLEINITIATOR
                               FROM    V_CATALOG.RESOURCE_POOLS
                              ORDER BY POOL_NM
                          "
    ;;


  rps)

    vsql -h 22.224.65.50 -U $UR -w $PW   << EOF 

--    SELECT    --NODE_NAME
--                         SUBSTR(SE.NODE_NAME,3,1)||SUBSTR(SE.NODE_NAME,14,2)   AS NODE
--                         ,SE.USER_NAME                                     AS USER
--    --                     ,SE.CLIENT_HOSTNAME                              AS CLIENT_H
--    --                   ,CLIENT_PID
--    --                   ,SE.LOGIN_TIMESTAMP
--                       ,SE.SESSION_ID                                                 AS SESSION
--                       ,SE.TRANSACTION_ID                                             AS TRANS_ID
--                       ,SE.STATEMENT_ID                                               AS STMT_ID
--    --                   ,SUBSTR(SE.CLIENT_LABEL,1,5)                                    AS APP
--    --                   ,TO_CHAR(SE.TRANSACTION_START,'YYYY-MM-DD-HH:MI:SS')        AS TRANS_STRT
--    --                   ,SE.TRANSACTION_ID                    AS TRAN_ID
--    --                   ,SE.TRANSACTION_DESCRIPTION
--                         ,TO_CHAR(SE.STATEMENT_START,'YYYY-MM-DD-HH:MI:SS')          AS STMT_STRT
--    --                   ,SE.STATEMENT_ID                                               AS STMT_ID
--    --                   ,SE.LAST_STATEMENT_DURATION_US
--    --                   ,SE.RUNTIME_PRIORITY
--                       --,SUBSTR(SE.CURRENT_STATEMENT,1,130)                             AS CUR_STMT
--                       --  ,SUM(CAST(RA.MEMORY_INUSE_KB/1024 AS DEC(10,2)))/3          AS 'USED_MEM(MB)'
--                         ,CAST((SUM(RA.MEMORY_INUSE_KB/1024 ))/3  AS DEC(10,2) )       AS 'USED_MEM(MB)'
--                       ,SUBSTR(SE.CURRENT_STATEMENT,1,300)                             AS CUR_STMT
--    --                   ,SUBSTR(LAST_STATEMENT,1,40)                                AS LST_STMT
--    --                  ,SE.SSL_STATE
--    --                   ,SE.AUTHENTICATION_METHOD
--                         --,CAST(RA.MEMORY_INUSE_KB/1024 AS DEC(10,2))          AS 'USED_MEM(MB)'
--                 FROM   SESSIONS SE
--                 --LEFT OUTER JOIN
--                        ,RESOURCE_ACQUISITIONS RA
--                --   ON  ( SE.TRANSACTION_ID = RA.TRANSACTION_ID AND SE.STATEMENT_ID = RA.STATEMENT_ID)
--                WHERE   SE.TRANSACTION_ID <> '-1'
--                   AND  SE.TRANSACTION_ID = RA.TRANSACTION_ID AND SE.STATEMENT_ID = RA.STATEMENT_ID
--                --WHERE
--                -- SE.TRANSACTION_ID = RA.TRANSACTION_ID
--                --  AND    SE.STATEMENT_ID = RA.STATEMENT_ID
--                  AND    SE.CURRENT_STATEMENT IS NOT NULL AND SE.CURRENT_STATEMENT <> ''
--                  GROUP BY SE.NODE_NAME
--                          ,SE.USER_NAME,SE.SESSION_ID,SE.TRANSACTION_ID,SE.STATEMENT_ID
--                           --,TO_CHAR(SE.STATEMENT_START,'YYYY-MM-DD-HH:MI:SS')
--                          ,STMT_STRT
--                           , SE.CURRENT_STATEMENT; 
--                          --,RA.MEMORY_INUSE_KB ;
--                --ORDER BY TRANS_STRT ;


select * from (
                            SELECT     RPS.POOL_NAME                                            AS POOL_NM
                                       ,RPS.NODE_NAME                                            AS NODE
                                     ,CAST((MEMORY_SIZE_ACTUAL_KB)/1024 AS DEC(10,2))      AS 'ACT(M)'
                                     ,CAST((MEMORY_INUSE_KB)/1024 AS DEC(10,2))            AS 'USE(M)'
                                     ,CAST((GENERAL_MEMORY_BORROWED_KB)/1024 AS DEC(10,2))   AS 'BORR(M)'
                                     ,MAX_CONCURRENCY                                      AS MAXCON
                                     ,PLANNED_CONCURRENCY                                  AS PL_CON 
                                     ,RUNNING_QUERY_COUNT                                  AS NUM_RUN
                                     ,MAX(RQ.position_in_queue)                                   AS QUE
                              FROM    RESOURCE_POOL_STATUS RPS
                              LEFT OUTER JOIN resource_queues RQ
                                ON RPS.POOL_NAME = RQ.POOL_NAME   
                               AND RPS.NODE_NAME = RQ.NODE_NAME   
                             --WHERE RPS.POOL_NAME NOT IN ('dbd','recovery','refresh','sysdata','sysquery','wosdata') 
                       WHERE --RPS.POOL_NAME ilike '%small_pool%'
			--	or RPS.POOL_NAME ilike '%medium_pool%'
			--	or RPS.POOL_NAME ilike '%large_pool%'
		       	        RPS.POOL_NAME ilike '%loading_pool%'
                             or RPS.POOL_NAME ILIKE '%dw_pool%'
                                or RPS.POOL_NAME ILIKE '%mart_pool%'
                                or RPS.POOL_NAME ILIKE '%general%'
                       --WHERE RPS.POOL_NAME ilike '%loading_pool%'
                       --WHERE RPS.POOL_NAME ilike '%general%'
                       --WHERE RPS.POOL_NAME ilike '%medium_pool%'
                       --WHERE RPS.POOL_NAME ilike '%large_pool%'
                             --or RPS.POOL_NAME ilike '%small%' 
                             --or RPS.POOL_NAME ilike '%load%' 
                             --   OR RPS.POOL_NAME = 'tm'
                             GROUP BY RPS.NODE_NAME,RPS.pool_name,3,4,5,6,7,8 
                            ORDER BY RPS.NODE_NAME
                            limit 32 
                       ) a order by pool_nm desc, node asc
			;

              --SELECT    SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)   AS NODE
                       --,ACTIVE_USER_SESSION_COUNT    AS ACT_USR_CNT
                   ----    ,ACTIVE_SYSTEM_SESSION_COUNT  AS ACTIVE_SYS
                       --,TOTAL_USER_SESSION_COUNT     AS TOT_USR_CNT
                   ----    ,TOTAL_SYSTEM_SESSION_COUNT   AS TOT_SYS
                       --,TOTAL_ACTIVE_SESSION_COUNT   AS TOT_ACT_CNT
                       --,TOTAL_SESSION_COUNT          AS TOT_SE_CNT
                       --,RUNNING_QUERY_COUNT          AS RUNNING_QRY
                   ----    ,EXECUTED_QUERY_COUNT         AS EXE_QRY
                        --FROM QUERY_METRICS         
               --ORDER BY 1 ;
                          
--     SELECT    --NODE_NAME
--                         SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)   AS NODE
--                         ,USER_NAME                                     AS USER
--                         ,CLIENT_HOSTNAME                              AS CLIENT_H
--    --                   ,CLIENT_PID
--    --                   ,LOGIN_TIMESTAMP
--                       ,SESSION_ID                                                 AS SESSION
--                       ,TRANSACTION_ID                                             AS TRANS_ID
--   --                    ,STATEMENT_ID                                               AS STMT_ID
--                       ,SUBSTR(CLIENT_LABEL,1,5)                                    AS APP
--    --                   ,TO_CHAR(TRANSACTION_START,'YYYY-MM-DD-HH:MI:SS')        AS TRANS_STRT
--    --                   ,TRANSACTION_ID                    AS TRAN_ID
--    --                   ,TRANSACTION_DESCRIPTION
--                       ,TO_CHAR(STATEMENT_START,'YYYY-MM-DD-HH:MI:SS')          AS STMT_STRT
--    --                   ,STATEMENT_ID                                               AS STMT_ID
--    --                   ,LAST_STATEMENT_DURATION_US
--    --                   ,RUNTIME_PRIORITY
--                       ,SUBSTR(CURRENT_STATEMENT,1,30)                             AS CUR_STMT
--    --                   ,SUBSTR(LAST_STATEMENT,1,40)                                AS LST_STMT
--    --                  ,SSL_STATE
--    --                   ,AUTHENTICATION_METHOD
--                 FROM   SESSIONS
--    --            WHERE   TRANSACTION_ID <> '-1'
--                 WHERE  CURRENT_STATEMENT IS NOT NULL AND CURRENT_STATEMENT <> '' 
--                  AND       USER_NAME ilike 'rel%';
--                --ORDER BY TRANS_STRT ;


EOF
  ;;    

  resrcacq)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   POOL_NAME                                               AS POOL_NM
                                    ,NODE_NAME                                               AS NODE
                                    ,TRANSACTION_ID                                          AS TRANS_ID
                                    ,STATEMENT_ID                                            AS STMT_ID
                                    ,THREAD_COUNT                                            AS THREAD_CNT
                                    ,OPEN_FILE_HANDLE_COUNT                                  AS OPEN_FILE_CNT
                                    ,CAST(MEMORY_INUSE_KB/1024 AS DEC(10,2))                 AS 'MEM_INUSE(MB)'
                                    ,TO_CHAR(QUEUE_ENTRY_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS.MS') AS QUEUE_ENTRY_TIMESTAMP
                                    ,TO_CHAR(ACQUISITION_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS.MS') AS ACQUISITION_TIMESTAMP
                                    ,ACQUISITION_TIMESTAMP-QUEUE_ENTRY_TIMESTAMP             AS QUEUE_WAIT    
                             FROM    V_MONITOR.RESOURCE_ACQUISITIONS
                            ORDER BY POOL_NAME
                          "
    ;;


  rpj)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    TO_CHAR(FIRST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS F_REJ_TM
                                     ,TO_CHAR(LAST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS L_REJ_TM
                                     ,SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)      AS NODE
                                     ,POOL_NAME                                                  AS POOL
                                     ,REASON
                                     ,RESOURCE_TYPE                                              AS RP_TYPE
                                     ,REJECTION_COUNT                                            AS REJ_CNT
                            --         ,TO_CHAR(FIRST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS F_REJ_TM
                            --         ,TO_CHAR(LAST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS L_REJ_TM
                                     ,LAST_REJECTED_VALUE                                        AS REJ_VALUE
                              FROM    RESOURCE_REJECTIONS
                             WHERE    FIRST_REJECTED_TIMESTAMP BETWEEN GETDATE() -7 AND GETDATE() 
                             ORDER BY FIRST_REJECTED_TIMESTAMP DESC
                                     ,LAST_REJECTED_TIMESTAMP DESC
                                     ,NODE_NAME
                                     ,POOL_NAME
                          "
   ;;           

 rpja)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    TO_CHAR(FIRST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS F_REJ_TM
                                     ,TO_CHAR(LAST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS L_REJ_TM
                                     ,SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)      AS NODE
                                     ,POOL_NAME                                                  AS POOL
                                     ,REASON
                                     ,RESOURCE_TYPE                                              AS RP_TYPE
                                     ,REJECTION_COUNT                                            AS REJ_CNT
                            --         ,TO_CHAR(FIRST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS F_REJ_TM
                            --         ,TO_CHAR(LAST_REJECTED_TIMESTAMP,'YYYY-MM-DD-HH:MI:SS') AS L_REJ_TM
                                     ,LAST_REJECTED_VALUE                                        AS REJ_VALUE
                              FROM    RESOURCE_REJECTIONS
                            -- WHERE    FIRST_REJECTED_TIMESTAMP BETWEEN GETDATE() -7 AND GETDATE()
                             ORDER BY FIRST_REJECTED_TIMESTAMP DESC
                                     ,LAST_REJECTED_TIMESTAMP DESC
                                     ,NODE_NAME
                                     ,POOL_NAME
                          "
   ;;


  qm)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)                   AS NODE
                       ,ACTIVE_USER_SESSION_COUNT    AS ACTIVE_USR
                       ,ACTIVE_SYSTEM_SESSION_COUNT  AS ACTIVE_SYS
                       ,TOTAL_USER_SESSION_COUNT     AS TOT_USR
                       ,TOTAL_SYSTEM_SESSION_COUNT   AS TOT_SYS
                       ,TOTAL_ACTIVE_SESSION_COUNT   AS TOT_ACT
                       ,TOTAL_SESSION_COUNT          AS TOT_SE
                       ,RUNNING_QUERY_COUNT          AS RUNNING_QUERY
                       ,EXECUTED_QUERY_COUNT         AS EXE_QUERY
                FROM    QUERY_METRICS
               ORDER BY 1"
    ;;

  qry)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   -- NODE_NAME
                            --         ,USER_NAME
                                     SESSION_ID                                          AS SE_ID
                            --         ,REQUEST_ID
                                     ,TRANSACTION_ID                                     AS TRANS_ID
                            --         ,STATEMENT_ID                                     AS STMT_ID
                                     ,CASE IS_EXECUTING WHEN 't' THEN 'RUNNING'
                                                       WHEN 'f' THEN 'IN THE PAST'  END  AS EXEC
                                     ,REQUEST_TYPE                                       AS TYPE
                            --        ,REQUEST_LABEL
                            --        ,SEARCH_PATH
                            --        ,MEMORY_ACQUIRED_MB
                            --        ,CASE SUCCESS WHEN 't' THEN 'SUCCESS'
                            --                      WHEN 'f' THEN 'F'  END  AS SUCCESS
                            --        ,ERROR_COUNT                     AS ERR_CNT
                            --        ,START_TIMESTAMP
                            --        ,END_TIMESTAMP
                                     ,REQUEST_DURATION_MS                                AS 'EXEC(MS)'
                            --         ,CAST(REQUEST_DURATION_MS/1000 AS DEC(8,3))       AS 'EXEC(S)'
                                     ,REQUEST                               AS STMT
                              FROM    V_MONITOR.QUERY_REQUESTS
                             WHERE    REQUEST_TYPE <> 'DDL' --SUCCESS = 'f'
                               AND   IS_EXECUTING = 't'
                               AND   SESSION_ID = '$2' 
                             ORDER BY --EXEC DESC
                                     TYPE
                                     ,'EXEC_TIME(S)' DESC
                       "
    ;;

  pjs)

    vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT   B.NODE_NAME                                            AS NODE 
                     ,B.PROJECTION_NAME                                      AS PROJECTION 
                     ,B.ROW_COUNT                                            AS ROW_CNT
                     ,CAST (B.ROW_COUNT AS FLOAT)/A.ROW_COUNT*100            AS 'ROW_CNT(%)'
                     ,B.USED_BYTES                                           AS USED_B
                     ,CAST(B.USED_BYTES AS FLOAT)/A.USED_BYTES*100           AS 'USED_B(%)'
               FROM   V_MONITOR.PROJECTION_STORAGE B,
                          (SELECT PROJECTION_NAME,
                                  SUM(ROW_COUNT) ROW_COUNT,
                                  SUM(USED_BYTES) USED_BYTES
                             FROM V_MONITOR.PROJECTION_STORAGE
                           WHERE PROJECTION_NAME NOT ILIKE '%NODE%'
                              AND ANCHOR_TABLE_NAME ILIKE '%$2%'
                            GROUP BY PROJECTION_NAME
                            ORDER BY PROJECTION_NAME) A
              WHERE   B.PROJECTION_NAME = A.PROJECTION_NAME
              ORDER   BY B.PROJECTION_NAME, B.NODE_NAME
             "
    ;;

  cnode)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT  SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)          AS NODE
                FROM   V_MONITOR.CRITICAL_NODES
            "
    ;;


  io)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)                                                AS NODE
                            --         ,start_time
                                     ,SUBSTR(TO_CHAR(start_time),1,13)                          AS STRT_H
                            --         ,end_time
                                     ,SUBSTR(TO_CHAR(end_time),1,13)                            AS END_H
                            --         ,read_kbytes_per_sec
                            --         ,written_kbytes_per_sec
                                     ,CAST(SUM(read_kbytes_per_sec)/1024 AS DEC(10,2))          AS 'READ(MB)/S' 
                                     ,CAST(SUM(written_kbytes_per_sec)/1024 AS DEC(10,2))       AS 'WRITE(MB)/S'
                              FROM    IO_USAGE
                             GROUP BY NODE_NAME
                                     ,SUBSTR(TO_CHAR(start_time),1,13) 
                                     ,SUBSTR(TO_CHAR(end_time),1,13) 
                            --         ,start_time
                            --         ,end_time
                            --         ,read_kbytes_per_sec 
                            --         ,written_kbytes_per_sec
                             ORDER BY NODE_NAME
             "
     ;;

  cpu)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)           AS NODE
                                     ,TO_CHAR(START_TIME,'YYYY-MM-DD HH')                     AS TIME
                                     ,CAST(AVG(AVERAGE_CPU_USAGE_PERCENT) AS DEC(10,2))       AS 'CPU_USAGE(%)'
                              FROM    CPU_USAGE GROUP BY NODE_NAME, TO_CHAR(START_TIME,'YYYY-MM-DD HH')
                             ORDER BY 1,2 
                             LIMIT 50  ;
                           "
   ;;


  disk)

   vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    TO_CHAR(POLL_TIMESTAMP,'YYYY-MM-DD HH:MM:SS')     AS POLL_TM
                                    ,SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)      AS NODE
                                    ,PATH
                                    ,DEVICE
                                    ,FILESYSTEM
                                    ,CAST(USED_BYTES/1024/1024/1024 AS DEC(10,2))          AS 'USED_SZ(G)'
                                    ,CAST(FREE_BYTES/1024/1024/1024 AS DEC(10,2))          AS 'FREE_SZ(G)'
                                    ,USAGE_PERCENT                                         AS 'FREE(%)'
                             FROM    STORAGE_USAGE
                            ORDER BY NODE_NAME
                         "
     ;;

  ds)

     vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)      AS NODE
                                      ,STORAGE_PATH                                       AS PATH
                             --         ,STORAGE_USAGE                                      AS USAGE
                             --         ,RANK                                            
                             --         ,THROUGHPUT 
                             --         ,LATENCY          
                                      ,STORAGE_STATUS                                     AS STATUS
                                      ,DISK_BLOCK_SIZE_BYTES                              AS 'BLOCK(B)'  
                                      ,DISK_SPACE_USED_BLOCKS                             AS USED_BLOCKS
                                      ,CAST(DISK_SPACE_USED_MB/1024 AS DEC(10,2))          AS 'USED_SZ(G)'
                                      ,DISK_SPACE_FREE_BLOCKS                             AS FREE_BLOCKS
                                      ,CAST(DISK_SPACE_FREE_MB/1024 AS DEC(10,2))         AS 'FREE_SZ(G)'
                                      ,DISK_SPACE_FREE_PERCENT                            AS 'FREE(%)'
                               FROM    DISK_STORAGE
                              WHERE    STORAGE_USAGE = 'DATA,TEMP'
                              ORDER BY NODE_NAME
                             "
      ;;   
  
  err)

     vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    TO_CHAR(EVENT_TIMESTAMP,'YYYY-MM-DD HH:MM:SS')     AS EVENT_TM
                                      ,SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)      AS NODE 
                            --          ,USER_ID 
                                      ,USER_NAME
                                      ,SESSION_ID
                            --          ,REQUEST_ID
                            --          ,TRANSACTION_ID
                            --          ,STATEMENT_ID                       
                                      ,ERROR_LEVEL
                                      ,ERROR_CODE          
                                      --,SUBSTR(MESSAGE,1,65)                                AS MSG
                                      ,MESSAGE                                AS MSG
                            --          ,DETAIL
                                      ,HINT
                               FROM    ERROR_MESSAGES
                             -- WHERE    DATE(EVENT_TIMESTAMP) =  DATE(CURRENT_TIMESTAMP)
                                WHERE    ERROR_LEVEL NOT IN ('INFO')
                        --        AND  
                             ORDER BY EVENT_TIMESTAMP  DESC
--                                  LIMIT 50
 
 "
      ;;


################   CATALOG   #########################################################################   


  grant) 

   vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT    --GRANTOR                             
                                   --,PRIVILEGES_DESCRIPTION              AS PRIVILEGE 
                                   GRANTEE                             
                                   ,OBJECT_SCHEMA                       AS SCHEMA
                                   ,OBJECT_NAME                         AS NAME
                                   ,PRIVILEGES_DESCRIPTION              AS PRIVILEGE 
                                   ,GRANTOR
                            FROM    GRANTS
--                           WHERE    OBJECT_NAME = '$2'  
                           ORDER BY GRANTEE
                          "
   ;;

  tab)

   vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT   --TABLE_SCHEMA_ID                   AS 
                                   TAB.TABLE_SCHEMA                                       AS SCHEMA
                           --        ,TABLE_ID                          AS 
                                   ,TAB.TABLE_NAME                                        AS TABLE
                           --        ,TAB.OWNER_ID                      AS 
                                   ,TAB.OWNER_NAME                                        AS OWNER
                                   ,CASE WHEN IS_TEMP_TABLE = 't' THEN 'TEMP'
                                         WHEN IS_TEMP_TABLE = 'f' THEN 'NOT'
                                    END                                                   AS TEMP
                                   ,CASE WHEN IS_SYSTEM_TABLE = 't' THEN 'SYSTEM'
                                         WHEN IS_SYSTEM_TABLE = 'f' THEN 'NOT'
                                    END                                                   AS SYSTEM
                           --        ,TAB.SYSTEM_TABLE_CREATOR                              AS 
                                   ,SUBSTR(PARTITION_EXPRESSION,1,10)                     AS PART
                                   ,CASE WHEN PARTITION_EXPRESSION  = '' THEN 'NOT'
                                         ELSE 'PART'
                                    END                               AS PARTITION
                                   ,TO_CHAR(TAB.CREATE_TIME,'YYYY-MM-DD HH:MM:SS')        AS CRE_TIME
                           --        ,TAB.TABLE_DEFINITION                                  AS TAB_DEFINITION
                             FROM   V_CATALOG.TABLES TAB
                           -- WHERE    TAB.TABLE_SCHEMA IN ('SDPM','SDPD','REAL')
                    --          AND   TO_CHAR(TAB.CREATE_TIME,'YYYY-MM-DD HH:MM:SS') > '2012-12-01 00:00:00'  
                           ORDER BY TAB.TABLE_SCHEMA
                                   ,TAB.TABLE_NAME
                                   
                        "
   ;;

  tabpj)

   vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT   --TABLE_SCHEMA_ID                   AS
                                   TAB.TABLE_SCHEMA                                       AS SCHEMA
                           --        ,TABLE_ID                          AS
                                   ,TAB.TABLE_NAME                                        AS TABLE
                           --        ,TAB.OWNER_ID                      AS
                                   ,TAB.OWNER_NAME                                        AS OWNER
                                   ,CASE WHEN IS_TEMP_TABLE = 't' THEN 'TEMP'
                                         WHEN IS_TEMP_TABLE = 'f' THEN 'NOT'
                                    END                                                   AS TEMP
                                   ,CASE WHEN IS_SYSTEM_TABLE = 't' THEN 'SYSTEM'
                                         WHEN IS_SYSTEM_TABLE = 'f' THEN 'NOT'
                                    END                                                   AS SYSTEM
                           --        ,TAB.SYSTEM_TABLE_CREATOR                              AS
                                   ,SUBSTR(PARTITION_EXPRESSION,1,10)                     AS PART
                                   ,CASE WHEN PARTITION_EXPRESSION  = '' THEN 'NOT'
                                         ELSE 'PART'
                                    END                               AS PARTITION
                                   ,TO_CHAR(TAB.CREATE_TIME,'YYYY-MM-DD HH:MM:SS')        AS CRE_TIME
                           --        ,TAB.TABLE_DEFINITION                                  AS TAB_DEFINITION
                                   ,CASE WHEN HAS_STATISTICS = 't' THEN 'DONE'
                                         WHEN HAS_STATISTICS = 'f' THEN 'NEED'
                                    END                                                      AS RUNSTAT
                           --        ,PRO.PROJECTION_SCHEMA_ID
                           --        ,PRO.PROJECTION_SCHEMA                                    AS PRO_SCHEMA
                          --        ,PRO.PROJECTION_ID
                                --   ,PROJECTION_NAME                              AS PROJECTION
                                -- , PROJECTION_BASENAME
                                -- , OWNER_ID
                                -- , OWNER_NAME
                                -- , ANCHOR_TABLE_ID
                                -- , ANCHOR_TABLE_NAME
                                -- , NODE_ID
                                -- , NODE_NAME
                                -- , IS_PREJOIN
                                -- , CREATED_EPOCH
                                -- , CREATE_TYPE
                                -- , VERIFIED_FAULT_TOLERANCE
                                -- , IS_UP_TO_DATE
                                -- , HAS_STATISTICS
                                 , CASE WHEN IS_SEGMENTED = 't' THEN 'SEG'
                                        WHEN  IS_SEGMENTED = 'f' THEN 'UNSEG'
                                   END        AS SEG
                               FROM   V_CATALOG.TABLES TAB
                                   ,V_CATALOG.PROJECTIONS PRO
                            WHERE   TAB.TABLE_NAME = PRO.ANCHOR_TABLE_NAME
                              AND   TAB.TABLE_SCHEMA IN ('SDPM','SDPD','REAL')
                    --          AND   TO_CHAR(TAB.CREATE_TIME,'YYYY-MM-DD HH:MM:SS') > '2012-12-01 00:00:00'
                           ORDER BY TAB.TABLE_SCHEMA
                                   ,TAB.TABLE_NAME

                        "
   ;;

  tabpart)
 
   vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT   --TABLE_SCHEMA_ID                   AS 
                           --        SUBSTR(PART.NODE_NAME,3,1)||SUBSTR(PART.NODE_NAME,14,2)                                    AS NODE
                                   TAB.TABLE_SCHEMA                                       AS SCHEMA
                           --        ,TABLE_ID                          AS 
                                   ,TAB.TABLE_NAME                                        AS TABLE
                           --        ,TAB.OWNER_ID                      AS 
                           --        ,TAB.OWNER_NAME                                        AS OWNER
                           --        ,CASE WHEN IS_TEMP_TABLE = 't' THEN 'TEMP'
                           --              WHEN IS_TEMP_TABLE = 'f' THEN 'NOT'
                           --         END                                                   AS TEMP
                           --        ,CASE WHEN IS_SYSTEM_TABLE = 't' THEN 'SYSTEM'
                           --              WHEN IS_SYSTEM_TABLE = 'f' THEN 'NOT'
                           --         END                                                   AS SYSTEM
                           --        ,TAB.SYSTEM_TABLE_CREATOR                              AS 
                                   ,PARTITION_EXPRESSION                                   AS PARTITION
                                   ,PART.PARTITION_KEY                                    AS PART_KEY
                           --        ,TO_CHAR(TAB.CREATE_TIME,'YYYY-MM-DD HH:MM:SS')        AS CRE_TIME
                           --        ,TAB.TABLE_DEFINITION                                  AS TAB_DEF
                           --        ,PART.PROJECTION_ID                                    AS 
                           --        ,PART.TABLE_SCHEMA                                     AS 
                                   ,PRO.PROJECTION_NAME                                  AS PROJECTION
                           --        ,PART.ROS_ID                                           AS  ROS_ID
                           --        ,PART.ROS_SIZE_BYTES                                   AS 
                           --        ,PART.ROS_ROW_COUNT                                    AS 
                           --        ,PART.DELETED_ROW_COUNT                                AS 
                           --        ,PRO.PROJECTION_SCHEMA_ID                              AS 
                           --        ,PRO.PROJECTION_SCHEMA                                 AS 
                           --        ,PRO.PROJECTION_ID                                     AS 
                           --        ,PRO.PROJECTION_NAME                                   AS 
                           --        ,PRO.PROJECTION_BASENAME                               AS 
                           --        ,PRO.OWNER_ID                                          AS 
                           --        ,PRO.OWNER_NAME                                        AS 
                           --        ,PRO.ANCHOR_TABLE_ID                                   AS 
                           --        ,PRO.ANCHOR_TABLE_NAME                                 AS 
                           --        ,PRO.NODE_ID                                           AS 
                           --        ,PRO.NODE_NAME                                         AS 
                           --        ,PRO.IS_PREJOIN                                        AS 
                           --        ,PRO.CREATED_EPOCH                                     AS 
                           --        ,PRO.CREATE_TYPE                                       AS 
                           --        ,PRO.VERIFIED_FAULT_TOLERANCE                          AS 
                           --        ,PRO.IS_UP_TO_DATE                                     AS 
                           --        ,PRO.HAS_STATISTICS                                    AS 
                           --        ,CASE WHEN PRO.IS_SEGMENTED = 't' THEN 'SEG'
                           --              WHEN PRO.IS_SEGMENTED = 'f' THEN 'UNSEG'
                           --         END                                                   AS SEGMENT
                             FROM   V_CATALOG.TABLES TAB
                            INNER   JOIN   
                                    V_CATALOG.PROJECTIONS PRO 
                               ON   TAB.TABLE_NAME = PRO.ANCHOR_TABLE_NAME
                             LEFT   OUTER JOIN 
                                    V_MONITOR.PARTITIONS PART 
                               ON   PRO.PROJECTION_NAME = PART.PROJECTION_NAME
                            WHERE   TAB.TABLE_SCHEMA IN ('SDPM','SDPD','REAL')
                              AND   (PRO.PROJECTION_NAME ILIKE '%1' OR PRO.PROJECTION_NAME ILIKE '%1st')
  --                            AND   TAB.TABLE_NAME = '$2'
                           GROUP BY TAB.TABLE_SCHEMA
                                   ,TAB.TABLE_NAME
                                   ,PART.PARTITION_KEY 
                                   ,PRO.PROJECTION_NAME
                                   ,PARTITION_EXPRESSION
                           ORDER BY --PART.NODE_NAME
                                   TAB.TABLE_SCHEMA
                                   ,TAB.TABLE_NAME
                                   ,PART.PARTITION_KEY
            "
    ;;


  col)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   -- TABLE_SCHEMA_ID
                                      TAB.TABLE_SCHEMA                                             AS SCHEMA
                                     ,TAB.TABLE_NAME                                               AS TABLE
                                     ,COL.COLUMN_NAME                                              AS COL_NAME
                                     ,CCOL.CONSTRAINT_NAME                                         AS CONST_NAME
                                     ,CASE WHEN CCOL.CONSTRAINT_TYPE = 'c' THEN 'CHECK' 
                                           WHEN CCOL.CONSTRAINT_TYPE = 'f' THEN 'FOREIGN'
                                           WHEN CCOL.CONSTRAINT_TYPE = 'p' THEN 'PRIMARY'
                                           WHEN CCOL.CONSTRAINT_TYPE = 'u' THEN 'UNIQUE'
                                           WHEN CCOL.CONSTRAINT_TYPE = 'd' THEN 'DETERMINES'
                                           WHEN CCOL.CONSTRAINT_TYPE = 'n' THEN 'NOTNULL'
                                      END                                                          AS CONST_TYPE
                                     ,COL.DATA_TYPE
                                     ,COL.DATA_TYPE_LENGTH                                         AS LENGTH
                                     ,COL.NUMERIC_PRECISION                                        AS DEC
                                     ,COL.NUMERIC_SCALE                                            AS DEC_S
                                     ,CASE WHEN COL.IS_NULLABLE = 't' THEN 'NULLABLE'
                                           WHEN COL.IS_NULLABLE = 'f' THEN 'NOT NULL'
                                      END                                                          AS NULL
                                     ,COL.COLUMN_DEFAULT                                           AS DEFAULT
                   --                  ,COL.IS_IDENTITY
                                     ,MAX(TO_CHAR(CREATE_TIME,'YYYY-MM-DD-HH:MI:SS.MS'))                AS CRE_TIME
                              FROM    V_CATALOG.COLUMNS COL, V_CATALOG.TABLES TAB --, V_CATALOG.CONSTRAINT_COLUMNS CCOL
                              LEFT OUTER JOIN V_CATALOG.CONSTRAINT_COLUMNS CCOL ON TAB.TABLE_NAME = CCOL.TABLE_NAME
                             WHERE    TAB.TABLE_NAME = COL.TABLE_NAME
                               AND    TAB.TABLE_SCHEMA = COL.TABLE_SCHEMA
                   --            AND    TAB.TABLE_SCHEMA = CCOL.TABLE_SCHEMA
                   --            AND    TAB.TABLE_NAME = CCOL.TABLE_NAME 
                               AND    TAB.TABLE_NAME = '$2'
                             GROUP BY TAB.TABLE_SCHEMA
                                     ,TAB.TABLE_NAME
                                     ,COL.COLUMN_NAME
                                     ,CCOL.CONSTRAINT_NAME
                                     ,CONST_TYPE
                                     ,COL.DATA_TYPE
                                     ,LENGTH
                                     ,DEC
                                     ,DEC_S
                                     ,COL.IS_NULLABLE
                                     ,COL.COLUMN_DEFAULT
                                     ,CREATE_TIME
                             ORDER BY TAB.TABLE_SCHEMA
                                     ,TAB.TABLE_NAME
                                     ,COL.COLUMN_NAME

            "
    ;;


  tabsize)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   --SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)                                    AS NODE
                                      ANCHOR_TABLE_SCHEMA                           AS SCHEMA
                                     ,ANCHOR_TABLE_NAME                             AS TABLE
                                     ,PROJECTION_SCHEMA                             AS PSCHEMA 
                                     ,PROJECTION_NAME                               AS PROJECTION 
                            --         ,PROJECTION_COLUMN_COUNT                       AS P_COL_CNT
                            --         ,WOS_ROW_COUNT                                 AS WOS_ROW_CNT 
                            --         ,WOS_USED_BYTES                                AS 'WOS_USED(KB)'
                            --         ,ROS_ROW_COUNT                                 AS ROS_ROW_CNT
                            --         ,ROS_USED_BYTES                                AS 'ROS_USED(KB)'
                            --         ,ROS_COUNT                                     AS ROS_CNT
                                     ,SUM(ROW_COUNT)                                AS ROW_COUNT
                                     ,SUM(CAST(USED_BYTES/1024 AS DEC(15,2)))       AS 'USED(KB)'
                                 FROM V_MONITOR.PROJECTION_STORAGE
                             GROUP BY ANCHOR_TABLE_SCHEMA
                                     ,ANCHOR_TABLE_NAME
                                     ,PROJECTION_SCHEMA
                                     ,PROJECTION_NAME
                             ORDER BY ANCHOR_TABLE_NAME
                                     ,PROJECTION_NAME

                           "
    ;;

  skew)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    ANCHOR_TABLE_SCHEMA||'.'||ANCHOR_TABLE_NAME AS TABLE
                                     ,NODE_NAME                                   AS NODE
                                     ,projection_name                             AS PROJECTION 
                           --          ,projection_schema                                      
                           --          ,projection_column_count
                                     ,row_count
                           --          ,used_bytes
                           --          ,wos_row_count
                           --          ,wos_used_bytes
                           --          ,ros_row_count
                           --          ,ros_used_bytes
                           --          ,ros_count
                           --          ,anchor_table_name
                           --          ,anchor_table_schema
                           --          ,anchor_table_id
                           --          ,NODE_NAME                AS NODE
                           --          --,CAST(SUM(ROW_COUNT)/$3 AS INT)          AS COUNT
                           --          ,CAST(SUM(ROW_COUNT)/2 AS INT)          AS COUNT
                           --          ,MAX(ROW_COUNT)
                              FROM    PROJECTION_STORAGE
                             WHERE --   ANCHOR_TABLE_SCHEMA ='$2'  
                                      --ANCHOR_TABLE_NAME ='$2'
                                      ANCHOR_TABLE_NAME ilike '$2'
                           --    AND    projection_name not ilike '%node%'
                           --  GROUP BY ANCHOR_TABLE_SCHEMA||'.'||ANCHOR_TABLE_NAME 
                           --          ,NODE
                             ORDER BY PROJECTION_NAME 
                                     ,NODE 
                         "
    ;; 


  skew1)
 
    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT   -- ANCHOR_TABLE_NAME                   AS TABLE
                                    SUBSTR(NODE_NAME,3,1)||SUBSTR(NODE_NAME,14,2)                          AS NODE 
                                    ,ANCHOR_TABLE_NAME                   AS TABLE
                                    ,CAST(SUM(ROS_USED_BYTES)/1024/1024 AS DEC(10,2))        AS 'ROS_USED(MB)'
                                    ,SUM(ROS_ROW_COUNT)                  AS ROS_CNT 
                             FROM    PROJECTION_STORAGE
                            WHERE    ANCHOR_TABLE_NAME = '$2' 
                            GROUP BY 1,2 
                            ORDER BY 1,2
                         "
    ;;


   skewk) 
    
##    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    EXPORT_OBJECTS('','REAL.$2','false') " >  $SKEW/skew.tmp
    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    EXPORT_OBJECTS('','','false') " >  $SKEW/skew.tmp
    cat $SKEW/skew.tmp |grep -i SEGMENTED |grep "OFFSET 1"
##    cat $SKEW/skew.tmp |grep -i SEGMENTED |grep "OFFSET 1"|awk '{print $3}'


    ;; 
################   ADMIN   ###########################################################################   

  cnt)

    vsql -h 22.224.65.50 -U $UR -w $PW -t -c " SELECT    '$2'                               AS TABLE
                        ,COUNT(1)                          AS COUNT
                 FROM   $2
            "
    ;;


  dcnt)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    COUNT(DISTINCT $3)                 AS DISTINCT_CNT
                FROM $2
            "

   ;;


  ddl)

  ##  vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    EXPORT_OBJECTS('$OUTDIR/$2.ddl_$3','$2','false') "
    vsql -h 22.224.65.50 -U $UR -w $PW -t -c " SELECT    EXPORT_OBJECTS('','$2','false') "
    ;;


  ddla)

    vsql -h 22.224.65.50 -U $UR -w $PW -c " SELECT    EXPORT_OBJECTS('/home/dbadmin/Scripts/LOOK/LOOK.$2','','false') "
    ;;
  
  dja)

    vsql -h 22.224.65.50 -U $UR -w $PW -c "\dj "
    ;;


  dj)

    vsql -h 22.224.65.50 -U $UR -w $PW -c "\dj " |grep -i $2
    ;;


  dta)

    vsql -h 22.224.65.50 -U $UR -w $PW -c "\dt "
    ;;


  dt)

    vsql -h 22.224.65.50 -U $UR -w $PW -c "\dt " |grep -i $2
    ;;

##     tabsize)
##   
##       vsql -h 22.224.65.50 -U $UR -w $PW -c "\tabsize "
##       ;;

     lic)
   
       vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT GET_COMPLIANCE_STATUS() "
       ;;

     clo_se)
   
       vsql -h 22.224.65.50 -U $UR -w $PW -c "SELECT CLOSE_SESSION('$2') ;  "
       ;;
esac


